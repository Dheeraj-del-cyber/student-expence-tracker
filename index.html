<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Student Expense Calculator ‚Äî Weekly Category Report</title>
<style>
    :root{
        --bg1:#160624; --bg2:#2fa9cb; --bg3:#63520b;
        --card-bg: rgba(0,0,0,0.6);
        --accent:#ff3d00;
        --accent-hover:#ff6a3c;
        --muted: rgba(255,255,255,0.12);
    }
    *{box-sizing:border-box}
    body{
        margin:0;
        font-family: Arial, Helvetica, sans-serif;
        background: linear-gradient(135deg,var(--bg1),var(--bg2),var(--bg3));
        color:#fff;
        -webkit-font-smoothing:antialiased;
    }
    .container{
        max-width:900px;
        margin:18px auto;
        padding:18px;
        background:var(--card-bg);
        border-radius:12px;
    }
    h1,h2{margin:8px 0;text-align:center}
    label{display:block;margin-top:8px;font-size:0.95rem}
    input, button, select{
        padding:10px;
        margin-top:6px;
        border-radius:8px;
        border: none;
        font-size:1rem;
    }
    input[type="date"], input[type="text"], input[type="number"]{
        width:100%;
        background:rgba(255,255,255,0.03);
        color:#fff;
    }
    .row{display:flex;gap:10px;align-items:center}
    .col{flex:1}
    .dashboard{
        display:flex;
        gap:10px;
        justify-content:space-between;
        margin:12px 0;
        flex-wrap:wrap;
    }
    .dash-card{
        background:var(--muted);
        padding:12px;
        border-radius:10px;
        flex:1 1 30%;
        text-align:center;
        min-width:140px;
    }
    button{
        background:var(--accent);
        color:#fff;
        cursor:pointer;
        font-weight:600;
        transition: transform .18s ease, background .18s ease;
    }
    button:hover{ transform:scale(1.03); background:var(--accent-hover) }

    #search{width:100%; margin:10px 0; padding:10px; border-radius:8px; background:rgba(255,255,255,0.03); color:#fff }

    /* table */
    .table-wrap{ width:100%; overflow-x:auto; margin-top:10px; background:transparent; border-radius:8px; padding:6px 0; }
    table{ width:100%; border-collapse:collapse; min-width:620px; }
    th, td{ padding:10px 12px; text-align:center; border-bottom:1px solid rgba(255,255,255,0.06); font-size:0.95rem }
    th{ background:rgba(255,255,255,0.03) }
    .action-btn{ padding:6px 8px; border-radius:6px; background:rgba(255,255,255,0.04); cursor:pointer }
    .action-btn:hover{ background:rgba(255,255,255,0.08) }

    /* Weekly report */
    .report{
        margin-top:18px;
        padding:12px;
        background: rgba(255,255,255,0.03);
        border-radius:10px;
    }
    .report-list{ display:flex; flex-wrap:wrap; gap:10px; margin-top:10px }
    .report-item{
        background:rgba(255,255,255,0.04);
        padding:10px;
        border-radius:8px;
        min-width:160px;
        text-align:center;
    }

    /* animation */
    @keyframes fadeIn { from{opacity:0; transform:translateY(-8px)} to{opacity:1; transform:none} }
    .expense-row{ animation: fadeIn .45s ease both }

    @media (max-width:640px){
        .row{ flex-direction:column }
        .dashboard{ flex-direction:column; gap:8px }
        table { min-width:unset }
    }
</style>
</head>
<body>
<div class="container">
    <h1>üìä Student Expense Calculator</h1>

    <label for="budget">Monthly Budget üí∞</label>
    <input id="budget" type="number" placeholder="Enter monthly budget (‚Çπ)">

    <div class="dashboard">
        <div class="dash-card">Total Expenses: ‚Çπ<span id="totalExpenses">0</span></div>
        <div class="dash-card">Remaining Budget: ‚Çπ<span id="remainingBudget">0</span></div>
        <div class="dash-card">Total Entries: <span id="totalEntries">0</span></div>
    </div>

    <h2>Add Expense ‚ûï</h2>
    <div class="row">
        <div class="col">
            <label for="date">Date</label>
            <input id="date" type="date">
        </div>
        <div class="col">
            <label for="item">Item</label>
            <input id="item" type="text" placeholder="Item name (e.g., Notebook)">
        </div>
    </div>

    <div class="row" style="margin-top:6px">
        <div style="flex:1">
            <label for="category">Category</label>
            <input id="category" type="text" placeholder="Category (e.g., Stationary, Food)">
        </div>
        <div style="width:140px">
            <label for="amount">Amount (‚Çπ)</label>
            <input id="amount" type="number" placeholder="Amount">
        </div>
        <div style="width:120px; align-self:flex-end">
            <button id="addExpense" style="width:100%">Add</button>
        </div>
    </div>

    <input id="search" type="text" placeholder="Search by item, date or category (e.g., 2025-12-01 or Stationary)">

    <div class="table-wrap">
        <table aria-label="expenses table">
            <thead>
                <tr>
                    <th>Date</th>
                    <th>Item</th>
                    <th>Category</th>
                    <th>Amount (‚Çπ)</th>
                    <th>Action</th>
                </tr>
            </thead>
            <tbody id="expenseTable"></tbody>
        </table>
    </div>

    <div class="report" id="weeklyReport">
        <strong>Weekly Report (last 7 days)</strong>
        <div class="report-list" id="reportList">
            <!-- populated dynamically -->
        </div>
        <div style="margin-top:10px; font-size:0.9rem; color:rgba(255,255,255,0.8)">
            Report shows total spent per category for the last 7 days (including today).
        </div>
    </div>
</div>

<script>
/* -------------------------
   Data and storage helpers
   ------------------------- */
const STORAGE_KEY = 'student_expenses_v2';
const BUDGET_KEY = 'student_budget_v2';

let expenses = JSON.parse(localStorage.getItem(STORAGE_KEY)) || [];
let monthlyBudget = parseFloat(localStorage.getItem(BUDGET_KEY)) || 0;

/* --------- Elements --------- */
const totalExpensesEl = document.getElementById('totalExpenses');
const remainingBudgetEl = document.getElementById('remainingBudget');
const totalEntriesEl = document.getElementById('totalEntries');
const budgetInput = document.getElementById('budget');
const searchInput = document.getElementById('search');

budgetInput.value = monthlyBudget || '';

/* Utility: save */
function saveAll(){
    localStorage.setItem(STORAGE_KEY, JSON.stringify(expenses));
    localStorage.setItem(BUDGET_KEY, String(monthlyBudget || 0));
}

/* --------- Dashboard & Rendering --------- */
/* Render table accepts list of {item,date,category,amount,idx} where idx is original index in expenses */
function renderTable(listWithIndex){
    const tbody = document.getElementById('expenseTable');
    tbody.innerHTML = '';
    (listWithIndex || expenses.map((e,i)=>({e, idx:i}))).forEach(wrapper => {
        const e = wrapper.e;
        const originalIndex = wrapper.idx;
        const tr = document.createElement('tr');
        tr.className = 'expense-row';
        tr.innerHTML = `
            <td>${e.date}</td>
            <td style="text-align:left">${escapeHtml(e.item)}</td>
            <td>${escapeHtml(e.category)}</td>
            <td>‚Çπ${Number(e.amount).toFixed(2)}</td>
            <td>
                <button class="action-btn" data-action="edit" data-index="${originalIndex}">‚úè</button>
                <button class="action-btn" data-action="delete" data-index="${originalIndex}">üóë</button>
            </td>
        `;
        tbody.appendChild(tr);
    });
}

/* Update top dashboard numbers */
function updateDashboard(){
    const total = expenses.reduce((s, it) => s + Number(it.amount || 0), 0);
    totalExpensesEl.textContent = Number(total).toFixed(2);
    remainingBudgetEl.textContent = Number((monthlyBudget || 0) - total).toFixed(2);
    totalEntriesEl.textContent = expenses.length;
    // also refresh weekly report
    buildWeeklyReport();
}

/* Escape HTML to avoid injection if users paste markup */
function escapeHtml(s){
    return String(s || '').replace(/[&<>"']/g, m => ({'&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;',"'":'&#39;'})[m]);
}

/* --------- Add / Edit / Delete logic --------- */
document.getElementById('addExpense').addEventListener('click', (ev) => {
    ev.preventDefault && ev.preventDefault();
    const date = document.getElementById('date').value;
    const item = document.getElementById('item').value.trim();
    let category = document.getElementById('category').value.trim();
    category = category === ""?"Uncategorized" : category.toLowerCase();   
     const amountRaw = document.getElementById('amount').value;

    // validation
    if(!date || !item || amountRaw === '' || amountRaw === null){
        alert('Please fill Date, Item and Amount.');
        return;
    }
    const amount = parseFloat(amountRaw);
    if(Number.isNaN(amount) || amount <= 0){
        alert('Please enter a valid positive amount.');
        return;
    }

    // Add to expenses
    expenses.push({ date, item, category, amount });
    saveAll();
    renderTable();
    updateDashboard();

    // clear inputs
    document.getElementById('date').value = '';
    document.getElementById('item').value = '';
    document.getElementById('category').value = '';
    document.getElementById('amount').value = '';
});

/* Delegate clicks on edit/delete buttons */
document.getElementById('expenseTable').addEventListener('click', (e) => {
    const btn = e.target.closest('button');
    if(!btn) return;
    const action = btn.dataset.action;
    const idx = Number(btn.dataset.index);
    if(action === 'delete'){
        // remove item
        if(!Number.isInteger(idx)) return;
        expenses.splice(idx,1);
        saveAll();
        renderTable();
        updateDashboard();
    } else if(action === 'edit'){
        if(!Number.isInteger(idx)) return;
        const it = expenses[idx];
        document.getElementById('date').value = it.date;
        document.getElementById('item').value = it.item;
        document.getElementById('category').value = it.category;
        document.getElementById('amount').value = it.amount;
        // delete original so after editing user will add as new entry
        expenses.splice(idx,1);
        saveAll();
        renderTable();
        updateDashboard();
    }
});

/* Budget input handler */
budgetInput.addEventListener('input', () => {
    const v = parseFloat(budgetInput.value);
    monthlyBudget = Number.isNaN(v) ? 0 : v;
    saveAll();
    updateDashboard();
});

/* --------- Search / Filter --------- */
searchInput.addEventListener('input', () => {
    const q = searchInput.value.trim().toLowerCase();
    if(q === ''){
        renderTable();
        return;
    }
    // build list with original indices
    const filtered = expenses.map((e, i)=>({e, idx:i})).filter(w => {
        const e = w.e;
        return (e.item || '').toLowerCase().includes(q)
            || (e.category || '').toLowerCase().includes(q)
            || (e.date || '').includes(q);
    });
    renderTable(filtered);
});

/* --------- Weekly Report (last 7 days) --------- */
/* Computes totals per category for expenses whose date is within last 7 days (including today) */
function buildWeeklyReport(){
    const reportContainer = document.getElementById('reportList');
    reportContainer.innerHTML = '';
    if(!expenses.length){
        reportContainer.innerHTML = '<div style="opacity:0.8">No expenses yet</div>';
        return;
    }

    // compute date range: last 7 days including today
    const today = new Date();
    const start = new Date(today);
    start.setDate(start.getDate() - 6); // 7 days total: start..today

    // helper: convert YYYY-MM-DD to Date (local)
    function ymdToDate(s){
        const [y,m,d] = s.split('-').map(Number);
        if(!y || !m || !d) return null;
        return new Date(y, m-1, d);
    }

    // accumulate per category
    const totals = {}; // category -> number
    expenses.forEach(e => {
        const dt = ymdToDate(e.date);
        if(!dt) return;
        // compare (only date part)
        if(dt >= new Date(start.getFullYear(), start.getMonth(), start.getDate()) &&
           dt <= new Date(today.getFullYear(), today.getMonth(), today.getDate())){
            const cat = (e.category || 'Uncategorized').trim().toLowerCase();
            totals[cat] = (totals[cat] || 0) + Number(e.amount || 0);
        }
    });

    // if no items in last 7 days
    if(Object.keys(totals).length === 0){
        reportContainer.innerHTML = '<div style="opacity:0.8">No expenses in the last 7 days</div>';
        return;
    }

    // sort categories by amount desc
    const sorted = Object.entries(totals).sort((a,b)=>b[1]-a[1]);

    sorted.forEach(([cat, amt]) => {
        const div = document.createElement('div');
        div.className = 'report-item';
        div.innerHTML = `<div style="font-weight:700">${escapeHtml(cat)}</div><div style="margin-top:6px">‚Çπ${Number(amt).toFixed(2)}</div>`
        reportContainer.appendChild(div);
    });
}

/* Initialize UI */
renderTable();
updateDashboard();
buildWeeklyReport();

/* Optional: expose for debugging (remove in production) */
window._app = { expenses, saveAll, buildWeeklyReport };

</script>
</body>
</html>
